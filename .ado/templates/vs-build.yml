parameters:
  BuildConfiguration:
  BuildPlatform:
  VsInstallerUri:
  VsComponents:
  MSBuildVersion:
  MSBuildArchitecture:
  Solution:
  NugetConfigPath: ""
  MSBuildArguments: ""
  Collect: false

steps:
  - task: PowerShell@2
    displayName: Install Visual C++ Toolset 14.16
    inputs:
      targetType: filePath
      filePath: $(Build.SourcesDirectory)/vnext/Scripts/Tfs/Install-VsFeatures.ps1
      arguments: -InstallerUri ${{ parameters.VsInstallerUri }} -Components ${{ parameters.VsComponents }} -Collect:$${{ parameters.Collect }}

  - task: PublishBuildArtifacts@1
    displayName: "Publish Artifact: vslogs"
    condition: ${{ parameters.Collect }}
    inputs:
      PathtoPublish: $(System.DefaultWorkingDirectory)\vslogs
      ArtifactName: vslogs

  - task: NuGetCommand@2
    displayName: NuGet restore - ReactWindows
    inputs:
      command: restore
      restoreSolution: ${{ parameters.Solution }}
      feedsToUse: config
      nugetConfigPath: ${{ parameters.NugetConfigPath }}
      restoreDirectory: packages/
      verbosityRestore: Detailed # Options: quiet, normal, detailed

  - task: MSBuild@1
    displayName: MSBuild - ReactWindows
    inputs:
      solution: ${{ parameters.Solution }}
      msbuildVersion: ${{ parameters.MSBuildVersion }} # Optional. Options: latest, 16.0, 15.0, 14.0, 12.0, 4.0
      msbuildArchitecture: ${{ parameters.MSBuildArchitecture }} # Optional. Options: x86, x64
      platform: ${{ parameters.BuildPlatform }} # Optional
      configuration: ${{ parameters.BuildConfiguration }} # Optional
      msbuildArguments: /p:PreferredToolArchitecture=x64 ${{ parameters.MSBuildArguments }}
      clean: true # Optional
      #maximumCpuCount: false # Optional
