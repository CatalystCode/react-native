parameters:
  publishCommitId: '0'
  npmVersion: '0.0.1-pr'
  # Note: Nuget pack expects platform-specific file spearators ('\' on Windows).
  nugetroot: $(System.DefaultWorkingDirectory)\ReactWindows
  desktopId: 'OfficeReact.Win32'
  universalId: 'OfficeReact.UWP'

steps:
  - task: DownloadBuildArtifacts@0
    displayName: 'Download ReactWindows Artifact'
    inputs:
      artifactName: ReactWindows
      downloadPath: $(System.DefaultWorkingDirectory)

  # NuGetCommand@2 workaround: https://developercommunity.visualstudio.com/content/problem/288534/vsts-yaml-build-failure-the-task-name-nugetcommand.html
  - task: 333b11bd-d341-40d9-afcf-b32d5ce6f23b@2
    displayName: 'NuGet pack Desktop'
    inputs:
      command: pack
      packagesToPack: $(System.DefaultWorkingDirectory)/ReactWindows/ReactWin32.nuspec
      packDestination: $(System.DefaultWorkingDirectory)/NugetRootFinal
      buildProperties: CommitId=${{parameters.publishCommitId}};version=${{parameters.npmVersion}};id=${{parameters.desktopId}};nugetroot=${{parameters.nugetroot}}

  # NuGetCommand@2 workaround: https://developercommunity.visualstudio.com/content/problem/288534/vsts-yaml-build-failure-the-task-name-nugetcommand.html
  - task: 333b11bd-d341-40d9-afcf-b32d5ce6f23b@2
    displayName: 'NuGet pack Universal'
    inputs:
      command: pack
      packagesToPack: $(System.DefaultWorkingDirectory)/ReactWindows/ReactUWP.nuspec
      packDestination: $(System.DefaultWorkingDirectory)/NugetRootFinal
      buildProperties: CommitId=${{parameters.publishCommitId}};version=${{parameters.npmVersion}};id=${{parameters.universalId}};nugetroot=${{parameters.nugetroot}}
